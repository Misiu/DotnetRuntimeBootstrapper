<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" TreatAsLocalProperty="ApplicationIconFilePath;ApplicationManifestFilePath" ToolsVersion="4.0">

  <Target Name="CheckBootstrapperPrerequisites" AfterTargets="Build;Publish">
    <!-- Warning: not Windows executable -->
    <Warning Text="Project output type is not WinExe; boostrapper will not be created." Condition="'$(OutputType)' != 'WinExe'" />

    <!-- Warning: not Windows target platform -->
    <Warning Text="Target platform is not Windows; boostrapper will not be created." Condition="'$(TargetPlatformIdentifier)' != 'Windows'" />
  </Target>

  <Target Name="CreateBootstrapperAfterBuild" AfterTargets="Build" Condition="'$(OutputType)' == 'WinExe' AND '$(TargetPlatformIdentifier)' == 'Windows'">
    <PropertyGroup>
      <ApplicationIconFilePath Condition="'$(ApplicationIcon)' != ''">$([System.IO.Path]::Combine('$(ProjectDir)', '$(ApplicationIcon)'))</ApplicationIconFilePath>
      <ApplicationManifestFilePath Condition="'$(ApplicationManifest)' != ''">$([System.IO.Path]::Combine('$(ProjectDir)', '$(ApplicationManifest)'))</ApplicationManifestFilePath>
    </PropertyGroup>

    <CreateBootstrapperTask
      TargetApplicationName="$(AssemblyTitle)"
      TargetFilePath="$(TargetPath)"
      TargetRuntimeName="Microsoft.WindowsDesktop.App"
      TargetRuntimeVersion="$([System.String]::Copy('$(TargetFrameworkVersion)').Trim('v'))"
      IconFilePath="$(ApplicationIconFilePath)"
      ManifestFilePath="$(ApplicationManifestFilePath)" />
  </Target>

  <Target Name="CreateBootstrapperAfterPublish" AfterTargets="Publish" Condition="'$(OutputType)' == 'WinExe' AND '$(TargetPlatformIdentifier)' == 'Windows'">
    <PropertyGroup>
      <ApplicationIconFilePath Condition="'$(ApplicationIcon)' != ''">$([System.IO.Path]::Combine('$(ProjectDir)', '$(ApplicationIcon)'))</ApplicationIconFilePath>
      <ApplicationManifestFilePath Condition="'$(ApplicationManifest)' != ''">$([System.IO.Path]::Combine('$(ProjectDir)', '$(ApplicationManifest)'))</ApplicationManifestFilePath>
    </PropertyGroup>

    <CreateBootstrapperTask
      TargetApplicationName="$(AssemblyTitle)"
      TargetFilePath="$([System.IO.Path]::Combine('$(ProjectDir)', '$(PublishDir)/$(AssemblyName).dll'))"
      TargetRuntimeName="Microsoft.WindowsDesktop.App"
      TargetRuntimeVersion="$([System.String]::Copy('$(TargetFrameworkVersion)').Trim('v'))"
      IconFilePath="$(ApplicationIconFilePath)"
      ManifestFilePath="$(ApplicationManifestFilePath)" />
  </Target>

</Project>