# DotnetRuntimeBootstrapper

[![Build](https://github.com/Tyrrrz/DotnetRuntimeBootstrapper/workflows/CI/badge.svg?branch=master)](https://github.com/Tyrrrz/DotnetRuntimeBootstrapper/actions)
[![Version](https://img.shields.io/nuget/v/DotnetRuntimeBootstrapper.svg)](https://nuget.org/packages/DotnetRuntimeBootstrapper)
[![Downloads](https://img.shields.io/nuget/dt/DotnetRuntimeBootstrapper.svg)](https://nuget.org/packages/DotnetRuntimeBootstrapper)
[![Donate](https://img.shields.io/badge/donate-$$$-purple.svg)](https://tyrrrz.me/donate)

‚úÖ **Project status: active**.

DotnetRuntimeBootstrapper replaces the default `exe` shim generated by MSBuild for Windows executables with a fully featured bootstrapper that can download and install .NET runtime and other missing components required by your application.

> Designed primarily for bootstrapping desktop applications. Might not work optimally for other use cases.

## Download

üì¶ [NuGet](https://nuget.org/packages/DotnetRuntimeBootstrapper): `dotnet add package DotnetRuntimeBootstrapper`

## Features

- Acts as a tight shim around the target assembly
- Installs .NET runtime version required by the application
- Installs Visual C++ redistributable binaries, if missing
- Installs required Windows updates, if missing
- Includes basic GUI to guide the user through the process
- Works out-of-the-box on Windows 7 and higher

## Video

https://user-images.githubusercontent.com/1935960/120946093-1dd6d000-c6f0-11eb-9cfe-a373a00b4888.mp4

## Usage

### Build integration

To add DotnetRuntimeBootstrapper to your project, simply install the corresponding [NuGet package](https://nuget.org/packages/DotnetRuntimeBootstrapper).
MSBuild will automatically pick up the `props` and `targets` files provided by the package and integrate them inside the build process.

Once that's done, building or publishing the project should produce two additional files in the output directory:

```ini
MyApp.exe                 <-- bootstrapper executable
MyApp.exe.config          <-- runtime config required by the executable
MyApp.dll
MyApp.pdb
MyApp.deps.json
MyApp.runtimeconfig.json
```

When the user runs `MyApp.exe`, the bootstrapper will ensure that the required version of .NET runtime is available before delegating execution to the target assembly.
If the runtime or any of its prerequisites are not found, then the user is prompted with an option to download and install the missing components automatically.

> ‚ö†Ô∏è Make sure to include the `.config` file when distributing your application.
Bootstrapper executable may not be able to run without it.

### Inferred properties

DotnetRuntimeBootstrapper relies on a few common build properties for configuration:

- `<TargetFramework>` -- determines the version of .NET runtime checked by the bootstrapper
- `<AssemblyTitle>` -- specifies the title of the application as displayed by the bootstrapper
- `<ApplicationIcon>` -- specifies the icon file injected inside the bootstrapper
- `<ApplicationManifest>` -- specifies the manifest file injected inside the bootstrapper

### How it works

Bootstrapper executable is a pre-compiled binary built against legacy .NET Framework v3.5, which allows it to run out-of-the-box on all operating systems starting with Windows 7.
It's deployed during build by a custom MSBuild task in a series of steps:

1. Copy bootstrapper executable (`MyApp.exe`) to the output directory
2. Copy config file (`MyApp.exe.config`) to the output directory
3. Inject execution parameters as an embedded resource inside the bootstrapper
4. Inject file metadata, such as `ProductName`, `FileDescription`, `FileVersion`, `ProductVersion`, `LegalCopyright`
5. Inject application icon and manifest file, if specified by the project