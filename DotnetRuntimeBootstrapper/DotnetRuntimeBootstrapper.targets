<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" TreatAsLocalProperty="ApplicationIconFullPath" ToolsVersion="4.0">

  <PropertyGroup>
    <ApplicationIconFullPath Condition="'$(ApplicationIcon)' != ''">$([System.IO.Path]::Combine('$(ProjectDir)', '$(ApplicationIcon)'))</ApplicationIconFullPath>
  </PropertyGroup>

  <Target Name="CreateBootstrapper" AfterTargets="Build">
    <!-- Warning: not Windows executable -->
    <Warning Text="Project output type is not WinExe; boostrapper will not be created." Condition="'$(OutputType)' != 'WinExe'" />

    <!-- Warning: not Windows target platform -->
    <Warning Text="Target platform is not Windows; boostrapper will not be created." Condition="'$(TargetPlatformIdentifier)' != 'Windows'" />

    <!-- TODO: detect latest available runtime for a given target framework version -->
    <CreateBootstrapperTask
      Condition="'$(OutputType)' == 'WinExe' AND '$(TargetPlatformIdentifier)' == 'Windows'"
      TargetApplicationName="$(AssemblyTitle)"
      TargetFilePath="$(TargetPath)"
      TargetRuntimeName="Microsoft.WindowsDesktop.App"
      TargetRuntimeVersion="$([System.String]::Copy('$(TargetFrameworkVersion)').Trim('v'))"
      IconFilePath="$(ApplicationIconFullPath)" />
  </Target>

</Project>